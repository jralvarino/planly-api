openapi: "3.0.1"
info:
    title: Planly API
    version: "1.0.0"
    description: |
        Planly API - Habits, todos, categories and stats.
        Authenticate via POST /auth/login; use the returned JWT in Authorization header for protected endpoints.
components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
    schemas:
        LoginRequest:
            type: object
            required: [user, password]
            properties:
                user: { type: string }
                password: { type: string }
        LoginResponse:
            type: object
            properties:
                token: { type: string }
        VerifyResponse:
            type: object
            properties:
                valid: { type: boolean }
                userId: { type: string }
        UserProfile:
            type: object
            properties:
                userId: { type: string }
                name: { type: string }
                avatar: { type: string }
                createdAt: { type: string }
        Category:
            type: object
            properties:
                id: { type: string }
                userId: { type: string }
                name: { type: string }
                createdAt: { type: string }
                updatedAt: { type: string }
        CreateCategoryRequest:
            type: object
            required: [name]
            properties:
                name: { type: string }
        UpdateCategoryRequest:
            type: object
            required: [name]
            properties:
                name: { type: string }
        Habit:
            type: object
            properties:
                id: { type: string }
                userId: { type: string }
                title: { type: string }
                description: { type: string }
                color: { type: string }
                emoji: { type: string }
                unit: { type: string, enum: [count, pg, km, ml] }
                value: { type: string }
                period_type: { type: string, enum: [every_day, specific_days_week, specific_days_month] }
                period_value: { type: string }
                categoryId: { type: string }
                period: { type: string, enum: [Anytime, Morning, Afternoon, Evening] }
                reminder_enabled: { type: boolean }
                reminder_time: { type: string }
                start_date: { type: string }
                end_date: { type: string }
                active: { type: boolean }
                createdAt: { type: string }
                updatedAt: { type: string }
        CreateHabitRequest:
            type: object
            required: [title, categoryId]
            properties:
                title: { type: string }
                categoryId: { type: string }
                description: { type: string }
                color: { type: string }
                emoji: { type: string }
                unit: { type: string, enum: [count, pg, km, ml] }
                value: { type: string }
                period_type: { type: string, enum: [every_day, specific_days_week, specific_days_month] }
                period_value: { type: string }
                period: { type: string, enum: [Anytime, Morning, Afternoon, Evening] }
                reminder_time: { type: string }
                start_date: { type: string }
                end_date: { type: string }
                active: { type: boolean }
        UpdateHabitRequest:
            type: object
            properties:
                title: { type: string }
                description: { type: string }
                color: { type: string }
                emoji: { type: string }
                unit: { type: string, enum: [count, pg, km, ml] }
                value: { type: string }
                period_type: { type: string, enum: [every_day, specific_days_week, specific_days_month] }
                period_value: { type: string }
                categoryId: { type: string }
                period: { type: string, enum: [Anytime, Morning, Afternoon, Evening] }
                reminder_time: { type: string }
                start_date: { type: string }
                end_date: { type: string }
                active: { type: boolean }
        UpdateTodoStatusRequest:
            type: object
            required: [status, date]
            properties:
                date: { type: string, pattern: "^\\d{4}-\\d{2}-\\d{2}$", example: "2024-01-15" }
                status: { type: string, enum: [done, pending, skipped] }
                progressValue: { type: number, minimum: 0 }
                notes: { type: string }
        UpdateTodoNotesRequest:
            type: object
            required: [notes, date]
            properties:
                date: { type: string, pattern: "^\\d{4}-\\d{2}-\\d{2}$", example: "2024-01-15" }
                notes: { type: string }
        DailySummaryItem:
            type: object
            properties:
                date: { type: string, pattern: "^\\d{4}-\\d{2}-\\d{2}$" }
                total:
                    type: object
                    properties:
                        done: { type: integer }
                        skipped: { type: integer }
                        pending: { type: integer }
                        total: { type: integer }
                categories:
                    type: array
                    items:
                        type: object
                        properties:
                            categoryId: { type: string }
                            done: { type: integer }
                            skipped: { type: integer }
                            pending: { type: integer }
                            total: { type: integer }
        DashboardResponse:
            type: object
            required: [completedDates, globalStreak, globalLongestStreak, globalTotalCompletions, lastCompletedDate, monthCompletionCount, monthCompletionRate, daysInMonth]
            properties:
                completedDates: { type: array, items: { type: string } }
                globalStreak: { type: number }
                globalLongestStreak: { type: number }
                globalTotalCompletions: { type: number }
                lastCompletedDate: { type: [string, "null"] }
                monthCompletionCount: { type: number }
                monthCompletionRate: { type: number }
                daysInMonth: { type: number }
                habitsForSelectedDate: { type: array, items: { type: object } }
                categoryStreak: { type: number }
                categoryLongestStreak: { type: number }
                categoryTotalCompletions: { type: number }
                habitStreak: { type: number, description: "Present when habitId is provided" }
        Error:
            type: object
            properties:
                message: { type: string }
                code: { type: string }
                field: { type: string }
paths:
    /auth/login:
        post:
            summary: Login and get JWT token
            operationId: login
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/LoginRequest" }
            responses:
                "200":
                    description: Login successful, returns JWT token
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/LoginResponse" }
                "401":
                    description: Invalid credentials
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsAuthLogin
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /auth/verify:
        get:
            summary: Verify JWT token
            operationId: verify
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Token is valid
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/VerifyResponse" }
                "401":
                    description: Invalid or missing token
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsAuthVerify
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /user:
        get:
            summary: Get current user profile (without password)
            operationId: getUser
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: User profile
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/UserProfile" }
                "401":
                    description: Unauthorized - invalid or missing token
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: User not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsUser
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /categories:
        post:
            summary: Create a new category
            operationId: createCategory
            security:
                - bearerAuth: []
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/CreateCategoryRequest" }
            responses:
                "201":
                    description: Category created successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    category: { $ref: "#/components/schemas/Category" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        get:
            summary: Get all categories for the authenticated user
            operationId: getCategories
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: List of categories for the user
                    content:
                        application/json:
                            schema:
                                type: array
                                items: { $ref: "#/components/schemas/Category" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsCategories
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /categories/{id}:
        get:
            summary: Get category by ID for the authenticated user
            operationId: getCategoryById
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: Category details
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Category" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Category not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        put:
            summary: Update category
            operationId: updateCategory
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/UpdateCategoryRequest" }
            responses:
                "200":
                    description: Category updated successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    category: { $ref: "#/components/schemas/Category" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Category not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "409":
                    description: Category with new name already exists
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        delete:
            summary: Delete category
            operationId: deleteCategory
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: Category deleted successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    message: { type: string }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Category not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CategoryLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsCategoryById
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /habits:
        post:
            summary: Create a new habit
            operationId: createHabit
            security:
                - bearerAuth: []
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/CreateHabitRequest" }
            responses:
                "201":
                    description: Habit created successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    habit: { $ref: "#/components/schemas/Habit" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${HabitLambdaFunction.Arn}/invocations"
        get:
            summary: Get all habits for the authenticated user
            operationId: getHabits
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: List of habits for the user
                    content:
                        application/json:
                            schema:
                                type: array
                                items: { $ref: "#/components/schemas/Habit" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${HabitLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsHabits
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /todo/date:
        get:
            summary: Get habits for a specific date
            operationId: getTodoListByDate
            security:
                - bearerAuth: []
            parameters:
                - name: date
                  in: query
                  required: false
                  description: Date in YYYY-MM-DD format. If not provided, uses current date.
                  schema:
                      type: string
                      pattern: "^\\d{4}-\\d{2}-\\d{2}$"
                      example: "2024-01-15"
            responses:
                "200":
                    description: List of habits for the specified date (with todo metadata when applicable)
                    content:
                        application/json:
                            schema:
                                type: array
                                items: { $ref: "#/components/schemas/Habit" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsTodoByDate
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /todo/summary:
        get:
            summary: Get daily summary of todos
            operationId: getDailySummary
            security:
                - bearerAuth: []
            parameters:
                - name: startDate
                  in: query
                  required: true
                  description: Start date in YYYY-MM-DD format
                  schema:
                      type: string
                      pattern: "^\\d{4}-\\d{2}-\\d{2}$"
                      example: "2024-01-01"
                - name: endDate
                  in: query
                  required: true
                  description: End date in YYYY-MM-DD format
                  schema:
                      type: string
                      pattern: "^\\d{4}-\\d{2}-\\d{2}$"
                      example: "2024-01-31"
            responses:
                "200":
                    description: Daily summary of todos
                    content:
                        application/json:
                            schema:
                                type: array
                                items: { $ref: "#/components/schemas/DailySummaryItem" }
                "400":
                    description: Bad request - startDate and endDate are required
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsTodoSummary
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /todo/{habitId}:
        patch:
            summary: Update todo status
            operationId: updateTodoStatus
            security:
                - bearerAuth: []
            parameters:
                - name: habitId
                  in: path
                  required: true
                  schema:
                      type: string
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/UpdateTodoStatusRequest" }
            responses:
                "204":
                    description: Todo status updated successfully
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Todo or habit not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsTodoStatus
            parameters:
                - name: habitId
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS,PATCH'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /todo/{habitId}/notes:
        patch:
            summary: Update todo notes
            operationId: updateTodoNotes
            security:
                - bearerAuth: []
            parameters:
                - name: habitId
                  in: path
                  required: true
                  schema:
                      type: string
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/UpdateTodoNotesRequest" }
            responses:
                "204":
                    description: Todo notes updated successfully
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Todo or habit not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsTodoNotes
            parameters:
                - name: habitId
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS,PATCH'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /stats/globalStreak:
        get:
            summary: Get global streak for the authenticated user
            operationId: getGlobalStreak
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Global streak (current streak of USER stats)
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    currentStreak:
                                        type: integer
                                        description: Current streak in days
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsStatsGlobalStreak
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /stats/dashboard:
        get:
            summary: Get consolidated dashboard data for the stats screen
            operationId: getDashboard
            security:
                - bearerAuth: []
            parameters:
                - name: month
                  in: query
                  required: true
                  description: Month in YYYY-MM format
                  schema:
                      type: string
                      pattern: "^\\d{4}-\\d{2}$"
                      example: "2025-01"
                - name: categoryId
                  in: query
                  required: false
                  description: Optional category filter
                  schema:
                      type: string
                - name: habitId
                  in: query
                  required: false
                  description: Optional habit filter
                  schema:
                      type: string
                - name: selectedDate
                  in: query
                  required: false
                  description: Optional selected date (YYYY-MM-DD); when provided, includes habitsForSelectedDate
                  schema:
                      type: string
                      pattern: "^\\d{4}-\\d{2}-\\d{2}$"
                      example: "2025-01-15"
            responses:
                "200":
                    description: Dashboard data with completed dates, streaks, and optional habits list
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/DashboardResponse" }
                "400":
                    description: Bad request - month is required or invalid format
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsStatsDashboard
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
    /habits/{id}:
        get:
            summary: Get habit by ID
            operationId: getHabitById
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: Habit details
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Habit" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Habit not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${HabitLambdaFunction.Arn}/invocations"
        put:
            summary: Update habit
            operationId: updateHabit
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            requestBody:
                content:
                    application/json:
                        schema: { $ref: "#/components/schemas/UpdateHabitRequest" }
            responses:
                "200":
                    description: Habit updated successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    habit: { $ref: "#/components/schemas/Habit" }
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Habit not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${HabitLambdaFunction.Arn}/invocations"
        delete:
            summary: Delete habit
            operationId: deleteHabit
            security:
                - bearerAuth: []
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: Habit deleted successfully
                "401":
                    description: Unauthorized
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
                "404":
                    description: Habit not found
                    content:
                        application/json:
                            schema: { $ref: "#/components/schemas/Error" }
            x-amazon-apigateway-integration:
                type: aws_proxy
                httpMethod: POST
                uri:
                    Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${HabitLambdaFunction.Arn}/invocations"
        options:
            summary: CORS preflight
            operationId: optionsHabitById
            parameters:
                - name: id
                  in: path
                  required: true
                  schema:
                      type: string
            responses:
                "200":
                    description: CORS response
                    headers:
                        Access-Control-Allow-Origin:
                            schema:
                                type: string
                        Access-Control-Allow-Methods:
                            schema:
                                type: string
                        Access-Control-Allow-Headers:
                            schema:
                                type: string
            x-amazon-apigateway-integration:
                type: mock
                requestTemplates:
                    application/json: '{"statusCode": 200}'
                responses:
                    default:
                        statusCode: "200"
                        responseParameters:
                            method.response.header.Access-Control-Allow-Origin: "'*'"
                            method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
                            method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
